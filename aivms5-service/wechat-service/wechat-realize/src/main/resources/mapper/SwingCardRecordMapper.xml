<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.qlhx.dao.SwingCardRecordMapper">
	<resultMap id="BaseResultMap" type="com.qlhx.model.SwingCardRecord">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="cardNum" property="cardnum" jdbcType="VARCHAR" />
		<result column="swingCardTime" property="swingcardtime"
			jdbcType="VARCHAR" />
		<result column="type" property="type" jdbcType="INTEGER" />
		<result column="cardholderId" property="cardholderid" jdbcType="INTEGER" />
		<result column="egNum" property="egnum" jdbcType="VARCHAR" />
		<result column="proofMachineName" property="proofmachinename"
			jdbcType="VARCHAR" />
		<result column="inOutFlag" property="inoutflag" jdbcType="INTEGER" />
		<result column="isOpenDoor" property="isOpenDoor" jdbcType="INTEGER" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		id, cardNum, swingCardTime, type, cardholderId, egNum,
		proofMachineName, inOutFlag,isOpenDoor
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="Base_Column_List" />
		from u_swing_card_record
		where id = #{id,jdbcType=INTEGER}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		delete from u_swing_card_record
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.qlhx.model.SwingCardRecord">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into u_swing_card_record (id, cardNum, swingCardTime,
		type,
		cardholderId, egNum,
		proofMachineName, inOutFlag)
		values
		(#{id,jdbcType=INTEGER}, #{cardnum,jdbcType=VARCHAR},
		#{swingcardtime,jdbcType=VARCHAR},
		#{type,jdbcType=INTEGER},
		#{cardholderid,jdbcType=INTEGER}, #{egnum,jdbcType=VARCHAR},
		#{proofmachinename,jdbcType=VARCHAR}, #{inoutflag,jdbcType=INTEGER})
	</insert>
	<insert id="insertSelective" parameterType="com.qlhx.model.SwingCardRecord"
		useGeneratedKeys="true" keyProperty="id">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into u_swing_card_record
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="primaryId != null">
				primaryId,
			</if>
			<if test="companyCode != null">
				companyCode,
			</if>
			<if test="areaCode != null">
				areaCode,
			</if>
			<if test="terminalCode != null">
				terminalCode,
			</if>
			<if test="cardnum != null">
				cardNum,
			</if>
			<if test="swingcardtime != null">
				swingCardTime,
			</if>
			<if test="type != null">
				type,
			</if>
			<if test="cardholderid != null">
				cardholderId,
			</if>
			<if test="cardholderName != null">
				cardholderName,
			</if>
			<if test="egnum != null">
				egNum,
			</if>
			<if test="proofmachinename != null">
				proofMachineName,
			</if>
			<if test="inoutflag != null">
				inOutFlag,
			</if>
			<if test="isOpenDoor != null">
				isOpenDoor,
			</if>
			<if test="tabTime != null">
                tabTime,
            </if>
		    <if test="uploadTime != null">
		        uploadTime,
		    </if>
			<if test="native_createDate != null">
				native_createDate,
			</if>
			<if test="native_updateDate != null">
				native_updateDate,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="primaryId != null">
				#{primaryId,jdbcType=BIGINT},
			</if>
			<if test="companyCode != null">
				#{companyCode,jdbcType=VARCHAR},
			</if>
			<if test="areaCode != null">
				#{areaCode,jdbcType=VARCHAR},
			</if>
			<if test="terminalCode != null">
				#{terminalCode,jdbcType=VARCHAR},
			</if>
			<if test="cardnum != null">
				#{cardnum,jdbcType=VARCHAR},
			</if>
			<if test="swingcardtime != null">
				#{swingcardtime,jdbcType=VARCHAR},
			</if>
			<if test="type != null">
				#{type,jdbcType=INTEGER},
			</if>
			<if test="cardholderid != null">
				#{cardholderid,jdbcType=INTEGER},
			</if>
			<if test="cardholderName != null">
				#{cardholderName,jdbcType=VARCHAR},
			</if>
			<if test="egnum != null">
				#{egnum,jdbcType=VARCHAR},
			</if>
			<if test="proofmachinename != null">
				#{proofmachinename,jdbcType=VARCHAR},
			</if>
			<if test="inoutflag != null">
				#{inoutflag,jdbcType=INTEGER},
			</if>
			<if test="isOpenDoor != null">
				#{isOpenDoor,jdbcType=INTEGER},
			</if>
			<if test="tabTime != null">
		        #{tabTime,jdbcType=TIMESTAMP},
		    </if>
		    <if test="uploadTime != null">
		        #{uploadTime,jdbcType=TIMESTAMP},
		    </if>
			<if test="native_createDate != null">
				#{native_createDate},
			</if>
			<if test="native_updateDate != null">
				#{native_updateDate},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.qlhx.model.SwingCardRecord">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update u_swing_card_record
		<set>
			<if test="cardnum != null">
				cardNum = #{cardnum,jdbcType=VARCHAR},
			</if>
			<if test="swingcardtime != null">
				swingCardTime = #{swingcardtime,jdbcType=VARCHAR},
			</if>
			<if test="type != null">
				type = #{type,jdbcType=INTEGER},
			</if>
			<if test="cardholderid != null">
				cardholderId = #{cardholderid,jdbcType=INTEGER},
			</if>
			<if test="egnum != null">
				egNum = #{egnum,jdbcType=VARCHAR},
			</if>
			<if test="proofmachinename != null">
				proofMachineName = #{proofmachinename,jdbcType=VARCHAR},
			</if>
			<if test="inoutflag != null">
				inOutFlag = #{inoutflag,jdbcType=INTEGER},
			</if>
			<if test="isOpenDoor != null">
				isOpenDoor = #{isOpenDoor,jdbcType=INTEGER},
			</if>
			<if test="tabTime != null">
	            tabTime = #{tabTime,jdbcType=TIMESTAMP},
	        </if>
	        <if test="uploadTime != null">
	            uploadTime = #{uploadTime,jdbcType=TIMESTAMP},
	        </if>
	        <if test="native_updateDate != null">
			    native_updateDate = #{native_updateDate},
		    </if>
		</set>
		where id = #{id,jdbcType=INTEGER}  and areaCode = #{areaCode,jdbcType=VARCHAR} 
	</update>
	<update id="updateByPrimaryKey" parameterType="com.qlhx.model.SwingCardRecord">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update u_swing_card_record
		set cardNum = #{cardnum,jdbcType=VARCHAR},
		swingCardTime = #{swingcardtime,jdbcType=VARCHAR},
		type =
		#{type,jdbcType=INTEGER},
		cardholderId =
		#{cardholderid,jdbcType=INTEGER},
		egNum = #{egnum,jdbcType=VARCHAR},
		proofMachineName = #{proofmachinename,jdbcType=VARCHAR},
		inOutFlag =
		#{inoutflag,jdbcType=INTEGER}
		where id = #{id,jdbcType=INTEGER}
	</update>

	<select id="findAll" resultType="com.qlhx.model.SwingCardRecordBo">
		SELECT
		sc.*,
		( CASE WHEN sc.type = 0 THEN u.nickname WHEN sc.type = 1
		THEN v.NAME
		END ) sname,
		e.egName,
		e.egIP,
		e.egPort,
		c.companyName,
		c.companyCode
		FROM
		u_swing_card_record sc
		LEFT JOIN u_user u ON sc.cardholderId = u.id
		AND
		sc.type = 0
		LEFT JOIN u_visitor v ON sc.type = 1
		AND sc.cardholderId =
		v.id
		LEFT JOIN u_entrance_guard e ON sc.egNum = e.egNum
		LEFT JOIN u_company  c ON sc.companyCode = c.companyCode
		<include refid="where_all" />
		ORDER BY sc.swingCardTime DESC
		<include refid="limit_sql" />
	</select>

	<select id="findCount" resultType="java.lang.Integer">
		SELECT
		COUNT(1)
		FROM
		u_swing_card_record sc
		LEFT JOIN u_user u ON
		sc.cardholderId = u.id
		AND sc.type = 0
		LEFT JOIN u_visitor v ON sc.type
		= 1
		AND sc.cardholderId = v.id
		LEFT JOIN u_entrance_guard e ON sc.egNum = e.egNum
		LEFT JOIN u_company  c ON sc.companyCode = c.companyCode
		<include refid="where_all" />
	</select>

	<sql id="where_all">
		<where>

           <!-- 
			<if test="starttime == null or starttime =='' or endtime == null and endtime =='' ">
				sc.swingCardTime> date_format(now(),'%y-%m-%d')
			</if>
			 -->
			<if test="value != null and value !='' ">
				and u.nickname like
				CONCAT("%",#{value,jdbcType=VARCHAR},"%")
				OR v.NAME like
				CONCAT("%",#{value,jdbcType=VARCHAR},"%")
				OR sc.egNum like
				CONCAT("%",#{value,jdbcType=VARCHAR},"%")
				OR sc.cardNum like
				CONCAT("%",#{value,jdbcType=VARCHAR},"%")
			</if>
			<if test="starttime != null and starttime !='' ">
				and sc.swingCardTime > '${starttime}'
			</if>
			<if test="endtime != null and endtime !='' ">
				and sc.swingCardTime  <![CDATA[<]]>
				'${endtime}'
			</if>
			<if test="companyCode != null and companyCode !='' ">
				and sc.companyCode = #{companyCode,jdbcType=VARCHAR}
			</if>
			<if test="areaCode != null and areaCode !='' ">
				and sc.areaCode = #{areaCode,jdbcType=VARCHAR}
			</if>
			<!--  
			<if test=" inoutflag == null">
				AND sc.inOutFlag in ('1','2','3','4')
			</if>
			<if test=" inoutflag != null and inoutflag == 0">
				AND sc.inOutFlag in ('1','3')
			</if>
			<if test=" inoutflag != null and inoutflag == 1">
				AND sc.inOutFlag in ('2','4')
			</if>
			-->
			<if test="type != null ">
				AND sc.type = ${type}
			</if>
		</where>
	</sql>

	<sql id="limit_sql">
		<if test="page_sql != null and page_sql != ''">
			${page_sql}
		</if>
	</sql>
	
	<select id="selectSwingCardRecordByPama" resultType="com.qlhx.model.SwingCardRecord">
		SELECT * FROM u_swing_card_record
		WHERE 
		primaryId = #{primaryId} 
		AND companyCode = #{companyCode} 
		AND areaCode = #{areaCode}
		AND terminalCode = #{terminalCode}
		
	</select>
</mapper>