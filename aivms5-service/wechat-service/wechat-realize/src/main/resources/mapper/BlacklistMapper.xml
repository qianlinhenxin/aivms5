<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.qlhx.dao.BlacklistMapper">
	<resultMap id="BaseResultMap" type="com.qlhx.model.Blacklist">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="vId" property="vid" jdbcType="INTEGER" />
		<result column="reason" property="reason" jdbcType="VARCHAR" />
	</resultMap>
	<sql id="Base_Column_List">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		id, vId, reason
	</sql>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap"
		parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		select
		<include refid="Base_Column_List" />
		from u_blacklist
		where id = #{id,jdbcType=INTEGER}
	</select>

	<select id="selectBlacklistByVid" resultType="java.lang.Integer">
		select
		COUNT(1)
		from
		u_blacklist
		where vId = #{vId}
	</select>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		delete from u_blacklist
		where id = #{id,jdbcType=INTEGER}
	</delete>
	<insert id="insert" parameterType="com.qlhx.model.Blacklist">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into u_blacklist (id, vId, reason
		)
		values
		(#{id,jdbcType=INTEGER}, #{vid,jdbcType=INTEGER},
		#{reason,jdbcType=VARCHAR}
		)
	</insert>
	<insert id="insertSelective" parameterType="com.qlhx.model.Blacklist">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		insert into u_blacklist
		<trim prefix="(" suffix=")" suffixOverrides=",">
			<if test="id != null">
				id,
			</if>
			<if test="vid != null">
				vId,
			</if>
			<if test="vname != null">
				vname,
			</if>
			<if test="primaryId != null">
				primaryId,
			</if>
			<if test="companyCode != null">
				companyCode,
			</if>
			<if test="areaCode != null">
				areaCode,
			</if>
			<if test="terminalCode != null">
				terminalCode,
			</if>
			<if test="reason != null">
				reason,
			</if>
			<if test="native_createDate != null">
				native_createDate,
			</if>
			<if test="native_updateDate != null">
				native_updateDate,
			</if>
			<if test="tabTime != null">
				tabTime,
			</if>
			<if test="uploadTime != null">
				uploadTime,
			</if>
		</trim>
		<trim prefix="values (" suffix=")" suffixOverrides=",">
			<if test="id != null">
				#{id,jdbcType=INTEGER},
			</if>
			<if test="vid != null">
				#{vid,jdbcType=INTEGER},
			</if>
			<if test="vname != null">
				#{vname,jdbcType=VARCHAR},
			</if>
			<if test="primaryId != null">
				#{primaryId,jdbcType=BIGINT},
			</if>
			<if test="companyCode != null">
				#{companyCode,jdbcType=VARCHAR},
			</if>
			<if test="areaCode != null">
				#{areaCode,jdbcType=VARCHAR},
			</if>
			<if test="terminalCode != null">
				#{terminalCode,jdbcType=VARCHAR},
			</if>
			<if test="reason != null">
				#{reason,jdbcType=VARCHAR},
			</if>
			<if test="native_createDate != null">
				#{native_createDate},
			</if>
			<if test="native_updateDate != null">
				#{native_updateDate},
			</if>
			<if test="tabTime != null">
				#{tabTime},
			</if>
			<if test="uploadTime != null">
				#{uploadTime},
			</if>
		</trim>
	</insert>
	<update id="updateByPrimaryKeySelective" parameterType="com.qlhx.model.Blacklist">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update u_blacklist
		<set>
			<if test="vid != null">
				vId = #{vid,jdbcType=INTEGER},
			</if>
			<if test="vname != null">
				vname = #{vname,jdbcType=VARCHAR},
			</if>
			<if test="reason != null">
				reason = #{reason,jdbcType=VARCHAR},
			</if>
			<if test="native_updateDate != null">
				native_updateDate = #{native_updateDate},
			</if>
		</set>
		where id = #{id,jdbcType=INTEGER}
	</update>
	<update id="updateByCompanyCodeAndId" parameterType="com.qlhx.model.Blacklist">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update u_blacklist
		<set>
			<if test="vid != null">
				vId = #{vid,jdbcType=INTEGER},
			</if>
			<if test="vname != null">
				vname = #{vname,jdbcType=VARCHAR},
			</if>
			<if test="reason != null">
				reason = #{reason,jdbcType=VARCHAR},
			</if>
			<if test="native_updateDate != null">
				native_updateDate = #{native_updateDate},
			</if>
			<if test="tabTime != null">
				tabTime = #{tabTime},
			</if>
			<if test="uploadTime != null">
				uploadTime = #{uploadTime},
			</if>
		</set>
		where areaCode = #{areaCode,jdbcType=VARCHAR} and vId = #{vid,jdbcType=BIGINT}
	</update>
	<update id="updateByPrimaryKey" parameterType="com.qlhx.model.Blacklist">
		<!-- WARNING - @mbggenerated This element is automatically generated by 
			MyBatis Generator, do not modify. -->
		update u_blacklist
		set vId = #{vid,jdbcType=INTEGER},
		reason =
		#{reason,jdbcType=VARCHAR}
		where id = #{id,jdbcType=INTEGER}
	</update>
	<sql id="limit_sql">
		<if test="page_sql != null and page_sql != ''">
			${page_sql}
		</if>
	</sql>

	<sql id="where_all">
		   <if test="name != null and name !='' ">
				and name like CONCAT("%",#{name,jdbcType=VARCHAR},"%")
			</if>
		    <if test="idnum != null and idnum !='' ">
				and idnum like CONCAT("%",#{idnum,jdbcType=VARCHAR},"%")
			</if>
			<if test="companyCode != null and companyCode !='' ">
				and b.companyCode = #{companyCode,jdbcType=VARCHAR}
			</if>
			<if test="areaCode != null and areaCode !='' ">
				and b.areaCode = #{areaCode,jdbcType=VARCHAR}
			</if>
			<if test="today != null and today !='' ">
				and DATE_FORMAT(now(),'%Y-%m-%d') = DATE_FORMAT(b.native_createDate,'%Y-%m-%d')
			</if>
	</sql>
	<select id="selectBlacklistBo" resultType="com.qlhx.model.BlackListBo">
		SELECT
		v.*,
		c.companyName,
		c.companyCode,
		a.areaName,
		a.areaCode,
		b.id bid,
		b.reason,
		v.photo
		FROM
		u_blacklist b
		JOIN u_visitor v ON b.vId = v.id and b.areaCode = v.areaCode
		LEFT JOIN u_company  c ON b.companyCode = c.companyCode
		LEFT JOIN u_area  a ON b.areaCode = a.areaCode
		<where>
			<include refid="where_all" />
		</where>
		order by b.native_createDate desc
		<include refid="limit_sql" />
	</select>
	<select id="selectBlacklistBoCount" resultType="java.lang.Integer">
		SELECT
		COUNT(1)
		FROM
		u_blacklist b
		JOIN u_visitor v ON b.vId = v.id and b.areaCode = v.areaCode
		<where>
			<include refid="where_all" />
		</where>
	</select>


	<select id="findVisitorAndBlack" resultType="com.qlhx.model.BlackListBo">
		SELECT
		*
		FROM
		u_visitor v
		WHERE id NOT IN (SELECT vId FROM u_blacklist)
		<include refid="where_all" />
		<include refid="limit_sql" />
	</select>
	<select id="findVisitorAndBlackCount" resultType="java.lang.Integer">
		SELECT
		COUNT(1)
		FROM
		u_visitor v
		WHERE id NOT IN (SELECT vId FROM
		u_blacklist)
		<include refid="where_all" />
	</select>

	<select id="selectBlackByIdNum" resultType="java.lang.Integer">
		SELECT
		COUNT(1)
		FROM
		u_blacklist b
		JOIN u_visitor v ON b.vId = v.id
		where v.idNum ='${idNum}'

	</select>
	
	<select id="selectBlackByTel" resultType="java.lang.Integer">
		SELECT
		COUNT(1)
		FROM
		u_blacklist b
		JOIN u_visitor v ON b.vId = v.id and b.areaCode = v.areaCode
		where v.phone =#{tel}

	</select>
	

	<select id="findBlackListByVisitorId" resultType="com.qlhx.model.Blacklist">
		SELECT * FROM
		u_blacklist WHERE vId=#{vID}
	</select>
	
	<select id="selectBlacklistByPama" resultType="com.qlhx.model.Blacklist">
		SELECT * FROM u_blacklist
		WHERE 
		primaryId = #{primaryId} 
		AND companyCode = #{companyCode} 
		AND areaCode = #{areaCode}
		AND terminalCode = #{terminalCode}
		
	</select>
	
	<select id="selectBlackVisitorByPrimaryKey" resultType="com.qlhx.model.BlackListBo">
		SELECT
		v.*,b.reason,companyName
		FROM
		u_blacklist b JOIN u_visitor v ON b.vId = v.id and b.areaCode = v.areaCode
		LEFT JOIN u_company  c ON v.companyCode = c.companyCode
		where v.id = #{id}

	</select>
	
	<select id="selectBlackVisitorByParam" resultType="com.qlhx.model.BlackListBo">
		SELECT
		v.*,b.reason,companyName
		FROM
		u_blacklist b JOIN u_visitor v ON b.vId = v.id and b.areaCode = v.areaCode
		LEFT JOIN u_company  c ON v.companyCode = c.companyCode
		where v.id = #{id} and v.areaCode = #{areaCode}
        
	</select>
	
	<delete id="deleteBlackByVid">
		
		delete from u_blacklist
		where vid = #{vid} and areaCode = #{areaCode}
	</delete>


</mapper>